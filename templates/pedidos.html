{% extends 'inicio.html' %}
{% block content %}
<!-- Tip: se quiser, mova esse @import / <style> para o <head> do inicio.html -->
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

    :root{
      --bg: #0b0c0f;
      --card: #0f1114;
      --muted: #bfc4c9;
      --accent: #ff6b35;   /* ketchup quente */
      --accent-2: #ffd166; /* mostarda suave */
      --glass: rgba(255,255,255,0.04);
      --success: #6be36b;
      --danger: #ff6b6b;
      --radius: 14px;
    }

    body {
      background: linear-gradient(180deg, #070708 0%, #0b0c0f 100%);
      color: white;
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding: 24px;
    }

    .container-controls {
      display:flex;
      gap: 12px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom:18px;
    }

    /* Toggle look */
    .toggle {
      display:inline-flex;
      align-items:center;
      gap:10px;
      background: var(--glass);
      padding:8px 12px;
      border-radius: 999px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.5);
    }

    .toggle label {
      font-size:14px;
      color:var(--muted);
      cursor:pointer;
      user-select:none;
    }

    .toggle input[type="checkbox"]{
      appearance:none;
      width:44px;
      height:24px;
      background: rgba(255,255,255,0.08);
      border-radius:999px;
      position:relative;
      outline:none;
      cursor:pointer;
      transition: background .2s ease;
    }
    .toggle input[type="checkbox"]::after{
      content:'';
      position:absolute;
      width:18px;
      height:18px;
      border-radius:50%;
      top:3px;
      left:3px;
      background:white;
      transform:translateX(0);
      transition: transform .18s ease;
      box-shadow:0 2px 6px rgba(0,0,0,0.5);
    }
    .toggle input[type="checkbox"]:checked{
      background: linear-gradient(90deg, var(--accent), #ff8a5b);
    }
    .toggle input[type="checkbox"]:checked::after{
      transform:translateX(20px);
    }

    /* Grid for cards */
    .cards {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap:18px;
    }

    /* Card style */
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: var(--radius);
      padding:16px;
      box-shadow: 0 6px 18px rgba(2,6,12,0.6);
      border: 1px solid rgba(255,255,255,0.03);
      display:flex;
      flex-direction:column;
      gap:20px;
      transition: transform .18s ease, box-shadow .18s ease;
      overflow:hidden;
        width: 18vw;
    }
    .card:hover{
      transform: translateY(-6px) scale(1.01);
      box-shadow: 0 16px 34px rgba(0,0,0,0.6);
    }

    /* Header row */
    .card .head {
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
    }
    .card .order-id {
      font-weight:700;
      letter-spacing:0.6px;
      font-size:16px;
      color:var(--accent-2);
    }
    .card .time {
      font-size:13px;
      color:var(--muted);
    }

    /* Items list */
    .card .items {
      font-size:14px;
      color:#e8e8e8;
      line-height:1.4;
      display:block;
      max-height:120px;
      overflow:auto;
      padding-right:6px;
    }

    /* Footer */
    .card .meta {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .badge {
      padding:6px 10px;
      border-radius:999px;
      font-weight:600;
      font-size:13px;
      color:#0b0c0f;
      background:var(--accent-2);
    }
    .status {
      font-size:13px;
      padding:6px 10px;
      border-radius:999px;
      color:#0b0c0f;
      font-weight:700;
    }
    .status.pending { background: #ffd166; }
    .status.cooking { background: #ffb86b; }
    .status.done { background: var(--success); color:#072007; }

    /* Admin table */
    .table-wrapper{
      margin-top:12px;
      overflow:auto;
      border-radius:12px;
      border: 1px solid rgba(255,255,255,0.04);
    }
    .table{
      width:100%;
      border-collapse:collapse;
      min-width:700px;
    }
    .table th, .table td{
      padding:12px 14px;
      text-align:left;
      font-size:14px;
      color:var(--muted);
      border-bottom:1px solid rgba(255,255,255,0.02);
    }
    .table th{
      color:#fff;
      background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      position:sticky;
      top:0;
      z-index:2;
    }
    .table tr:hover td{
      background: rgba(255,255,255,0.01);
      color:#fff;
    }

    /* Responsive */
    @media (max-width:640px){
      .container-controls { flex-direction: column; align-items:stretch; }
      .toggle { justify-content:space-between; width:100%; }
      .card { padding:14px; }
      .table { min-width:unset; }
    }
</style>


<div class="container">

    <h2>Pedidos</h2>

    {% if session['papel'] == 'admin' and exibir_tabela %}
    <!-- ============================= -->
    <!--           TABELA ADMIN       -->
    <!-- ============================= -->

    <table class="tabela-pedidos">
        <thead>
        <tr>
            <th>Mesa</th>
            <th>Horário</th>
            <th>Item</th>
            <th>Status</th>
        </tr>
        </thead>
        <tbody>
        {% for grupo in pedidos %}
        {% for p in grupo.pedidos %}
        <tr>
            <td>{{ grupo.mesa }}</td>
            <td>{{ grupo.horario }}</td>
            <td>
                {% if p['lanche'] %}
                {{ p['lanche'] }}
                {% else %}
                {{ p['bebida'] }}
                {% endif %}
            </td>
            <td>
                {% if p['status'] %}
                Concluído
                {% else %}
                Em preparo
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        {% endfor %}
        </tbody>
    </table>

    {% else %}
    <!-- ============================= -->
    <!--          CARDS COZINHA       -->
    <!-- ============================= -->

    <div class="cards" aria-live="polite">

        {% for grupo in pedidos %}

        {% if exibir_concluidos in ['False', False] and grupo.status %}
        {# não exibe grupo concluído #}
        {% else %}

        <article class="card">

            <div class="head">
                <div>
                    <div class="order-id">
                        Mesa {{ grupo.mesa }}
                    </div>
                    <div style="font-size:13px; color:gray">
                        Horário: {{ grupo.horario }}
                    </div>
                </div>
            </div>

            <div class="items">

                {% for p in grupo.pedidos %}

                <div style="margin-bottom:10px; padding-bottom:6px; border-bottom:1px solid rgba(255,255,255,0.05);">

                    <div style="font-weight:600; color:#fff;">
                        Pedido #{{ p['id_pedido'] }}
                    </div>

                    <div style="margin-top:4px;">
                        {{ p['detalhamento'] }}
                    </div>

                    {% if p['ajustes_receita'] %}
                    <div style="margin-top:6px; font-size:12px; color:#ffd166;">
                        Ajustes: {{ p['ajustes_receita'] }}
                    </div>
                    {% endif %}

                </div>

                {% endfor %}

            </div>


            <div class="meta">
                <div>
            <span class="badge">
              {{ grupo.pedidos|length }} itens
            </span>
                </div>

                <div>
                    {% set status_grupo = grupo.pedidos[0]['status'] %}

                    {% if status_grupo == 0 %}
                    <a href="{{ url_for('alterar_status_pedido', id_pedido=grupo.pedidos[0]['id_pedido'], novo_status=1) }}"
                       class="status pending"
                       style="text-decoration:none;">
                        Iniciar Preparo
                    </a>

                    {% elif status_grupo == 1 %}
                    <a href="{{ url_for('alterar_status_pedido', id_pedido=grupo.pedidos[0]['id_pedido'], novo_status=2) }}"
                       class="status cooking"
                       style="text-decoration:none;">
                        Finalizar
                    </a>

                    {% elif status_grupo == 2 %}
                    <span class="status done">Finalizado</span>
                    {% endif %}

                </div>
            </div>

        </article>

        {% endif %}
        {% endfor %}

    </div>

    {% endif %}

</div>

{% endblock %}

