{% extends 'inicio.html' %}
{% block content %}
<!-- Tip: se quiser, mova esse @import / <style> para o <head> do inicio.html -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

:root{
  --bg: #0b0c0f;
  --card: #0f1114;
  --muted: #bfc4c9;
  --accent: #ff6b35;   /* ketchup quente */
  --accent-2: #ffd166; /* mostarda suave */
  --glass: rgba(255,255,255,0.04);
  --success: #6be36b;
  --danger: #ff6b6b;
  --radius: 14px;
}

body {
  background: linear-gradient(180deg, #070708 0%, #0b0c0f 100%);
  color: white;
  font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  padding: 24px;
}

.container-controls {
  display:flex;
  gap: 12px;
  flex-wrap:wrap;
  align-items:center;
  margin-bottom:18px;
}

/* Toggle look */
.toggle {
  display:inline-flex;
  align-items:center;
  gap:10px;
  background: var(--glass);
  padding:8px 12px;
  border-radius: 999px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.5);
}

.toggle label {
  font-size:14px;
  color:var(--muted);
  cursor:pointer;
  user-select:none;
}

.toggle input[type="checkbox"]{
  appearance:none;
  width:44px;
  height:24px;
  background: rgba(255,255,255,0.08);
  border-radius:999px;
  position:relative;
  outline:none;
  cursor:pointer;
  transition: background .2s ease;
}
.toggle input[type="checkbox"]::after{
  content:'';
  position:absolute;
  width:18px;
  height:18px;
  border-radius:50%;
  top:3px;
  left:3px;
  background:white;
  transform:translateX(0);
  transition: transform .18s ease;
  box-shadow:0 2px 6px rgba(0,0,0,0.5);
}
.toggle input[type="checkbox"]:checked{
  background: linear-gradient(90deg, var(--accent), #ff8a5b);
}
.toggle input[type="checkbox"]:checked::after{
  transform:translateX(20px);
}

/* Grid for cards */
.cards {
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap:18px;
}

/* Card style */
.card {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: var(--radius);
  padding:16px;
  box-shadow: 0 6px 18px rgba(2,6,12,0.6);
  border: 1px solid rgba(255,255,255,0.03);
  display:flex;
  flex-direction:column;
  gap:20px;
  transition: transform .18s ease, box-shadow .18s ease;
  overflow:hidden;
    width: 18vw;
}
.card:hover{
  transform: translateY(-6px) scale(1.01);
  box-shadow: 0 16px 34px rgba(0,0,0,0.6);
}

/* Header row */
.card .head {
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:center;
}
.card .order-id {
  font-weight:700;
  letter-spacing:0.6px;
  font-size:16px;
  color:var(--accent-2);
}
.card .time {
  font-size:13px;
  color:var(--muted);
}

/* Items list */
.card .items {
  font-size:14px;
  color:#e8e8e8;
  line-height:1.4;
  display:block;
  max-height:120px;
  overflow:auto;
  padding-right:6px;
}

/* Footer */
.card .meta {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
.badge {
  padding:6px 10px;
  border-radius:999px;
  font-weight:600;
  font-size:13px;
  color:#0b0c0f;
  background:var(--accent-2);
}
.status {
  font-size:13px;
  padding:6px 10px;
  border-radius:999px;
  color:#0b0c0f;
  font-weight:700;
}
.status.pending { background: #ffd166; }
.status.cooking { background: #ffb86b; }
.status.done { background: var(--success); color:#072007; }

/* Admin table */
.table-wrapper{
  margin-top:12px;
  overflow:auto;
  border-radius:12px;
  border: 1px solid rgba(255,255,255,0.04);
}
.table{
  width:100%;
  border-collapse:collapse;
  min-width:700px;
}
.table th, .table td{
  padding:12px 14px;
  text-align:left;
  font-size:14px;
  color:var(--muted);
  border-bottom:1px solid rgba(255,255,255,0.02);
}
.table th{
  color:#fff;
  background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  position:sticky;
  top:0;
  z-index:2;
}
.table tr:hover td{
  background: rgba(255,255,255,0.01);
  color:#fff;
}

/* Responsive */
@media (max-width:640px){
  .container-controls { flex-direction: column; align-items:stretch; }
  .toggle { justify-content:space-between; width:100%; }
  .card { padding:14px; }
  .table { min-width:unset; }
}
</style>

<div class="container-controls">
  <!-- Form 1: exibir concluidos -->
  <form method="get" action="{{ url_for('pedidos') }}" style="display:inline;">
    <input type="hidden" name="exibir_tabela" value="{{ exibir_tabela }}">
    <input type="hidden" name="exibir_concluidos" value="{{ exibir_concluidos }}">
    <input type="hidden" name="form" value="exibir_concluidos">
    <div class="toggle" title="Mostrar/ocultar pedidos concluídos">
      {% if exibir_tabela in ['True', True] %}
        <label for="exibir_concluidos">Exibir concluídos</label>
        <input type="checkbox" id="exibir_concluidos" name="tabela" onchange="this.form.submit()" checked>
      {% else %}
        <label for="exibir_concluidos2">Exibir concluídos</label>
        <input type="checkbox" id="exibir_concluidos2" name="tabela" onchange="this.form.submit()">
      {% endif %}
    </div>
  </form>

  <!-- Admin: exibir tabela -->
  {% if session['papel'] == 'admin' %}
    <form method="get" action="{{ url_for('pedidos') }}" style="display:inline;">
      <input type="hidden" name="exibir_tabela" value="{{ exibir_tabela }}">
      <input type="hidden" name="exibir_concluidos" value="{{ exibir_concluidos }}">
      <input type="hidden" name="form" value="exibir_tabela">
      <div class="toggle" title="Alternar visualização em tabela">
        {% if exibir_tabela in ['True', True] %}
          <label for="exibir_tabela">Exibir tabela</label>
          <input type="checkbox" id="exibir_tabela" name="tabela" onchange="this.form.submit()" checked>
        {% else %}
          <label for="exibir_tabela2">Exibir tabela</label>
          <input type="checkbox" id="exibir_tabela2" name="tabela" onchange="this.form.submit()">
        {% endif %}
      </div>
    </form>
  {% endif %}
</div>

<!-- Se admin escolheu tabela -->
{% if session['papel'] == 'admin' and exibir_tabela in ['True', True] %}
  <div class="table-wrapper">
    <table class="table" role="table" aria-label="Tabela de pedidos">
      <thead>
        <tr>

          <th>#Pedido</th>
          <th>Cliente</th>
          <th>Itens</th>
          <th>Tempo</th>
          <th>Status</th>
          <th>Valor</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for p in pedidos %}
        <tr>
          <td><strong>{{ p['id_pedido'] }}</strong></td>

          <td>{{ p['nome_cliente'] or p['cliente'] }}</td>
          <td style="max-width:340px;">
            {% for item in p['itens'] %}
              <div style="font-size:13px; color:#e6e6e6;">• {{ item['qtd'] }} × {{ item['nome'] }}</div>
            {% endfor %}
          </td>
          <td>{{ p['tempo_pedido'] or p['created_at'] }}</td>
          <td>
            {% if p['status'] %}
              <span class="status done">Concluído</span>
            {% else %}
              <span class="status pending">Pendente</span>
            {% endif %}
          </td>
          <td>R$ {{ '%.2f'|format(p['valor']|float) }}</td>
          <td>
            <!-- Links de ação (editar/visualizar) -->
            <a href="{{ url_for('ver_pedido', id_pedido=p['id_pedido']) }}" class="badge">Ver</a>
            <a href="{{ url_for('editar_pedido', id_pedido=p['id_pedido']) }}" class="badge" style="background:var(--accent)">Editar</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

<!-- Se visualização em cards (padrão para cozinha/usuario) -->
{% else %}
  <div class="cards" aria-live="polite">
    {% for p in pedidos %}
      {% if exibir_concluidos in ['False', False] and p['status'] %}
        {# pulando pedidos concluídos quando a opção está desativada #}
      {% else %}
        <article class="card" role="article" aria-labelledby="pedido-{{p['id_pedido']}}">
          <div class="head">
            <div>
              <div class="order-id" id="pedido-{{p['id_pedido']}}">Pedido #{{ p['id_pedido'] }}</div>
              <div style="font-size:13px; color:var(--muted)">vendedor: {{ p['pessoa'] or 'Cliente' }}</div>
            </div>
            <div class="time">{{ p['tempo_pedido'] or p['created_at'] }}</div>
          </div>

          <div class="items">
              {% if p['lanche'] %}
                {{p['lanche']}}
              {% else %}
                {{p['bebida']}}
              {% endif %}
<!--            {% if p['itens'] %}-->
<!--              {% for item in p['itens'] %}-->
<!--                <div><strong>{{ item['qtd'] }}x</strong> {{ item['nome'] }} {% if item['observacao'] %}- <small style="color:var(&#45;&#45;muted)">{{ item['observacao'] }}</small>{% endif %}</div>-->
<!--              {% endfor %}-->
<!--            {% else %}-->
<!--              <div style="color:var(&#45;&#45;muted)">Sem itens listados</div>-->
<!--            {% endif %}-->

          </div>

          <div class="meta">
            <div>
              <span class="badge">Mesa: {{ p['numero_da_mesa'] or 'entrega' }}</span>
              {% if p['adicional'] %}<span style="margin-left:8px; font-size:13px; color:var(--muted)">{{ p['adicional'] }}</span>{% endif %}
            </div>
            <div>
              {% if p['status'] %}
                <span class="status done">Concluído</span>
              {% else %}
                <span class="status cooking">Em preparo</span>
              {% endif %}
            </div>
          </div>
        </article>
      {% endif %}
    {% endfor %}
  </div>
{% endif %}

{% endblock %}