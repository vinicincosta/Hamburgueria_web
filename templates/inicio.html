<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Início</title>
    <!--    <link rel="stylesheet" href="../static/style.css">-->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='imgdois.png') }}" type="image/png">
    <script src="{{ url_for('static', filename='script.js') }}"></script>


</head>
<body style="background-color: #161E25">
<div id="flash-data"
     data-flashes='{{ get_flashed_messages(with_categories=true) | tojson | safe }}'></div>

<script>
    const flashContainer = document.getElementById('flash-data');
    const flashMessages = JSON.parse(flashContainer.dataset.flashes || '[]');
    flashMessages.forEach(([category, message]) => {
        const div = document.createElement('div');
        div.textContent = message;
        div.className = `flash-message ${category}`;
        document.body.appendChild(div);
        setTimeout(() => div.remove(), 4000);
    });
</script>

<nav id="nav">
    <div class="container-nav">
        <div class="header-nav">
            <img onclick="closeNav()" id="close-menu" src="https://images.icon-icons.com/2518/PNG/512/x_icon_150997.png"
                 alt="Fechar">
        </div>
        <div class="content-nav">
            {% if session['papel'] == 'admin' %}
            <a href="{{ url_for('pessoas') }}">FUNCIONÁRIOS</a>


            <a href="{{url_for('vendas')}}">VENDAS</a>


            <a href="{{url_for('lanche_insumos')}}">RECEITA</a>


            {% endif %}
            <a href="{{url_for('pedidos')}}">PEDIDOS</a>

        </div>
    </div>
</nav>
<header>
    <div class="header-content">
        <div id="menu-button" onclick="openNav()">&#9776</div>

        <a href="{{ url_for('index') }}">
            <img id="logo" src="{{ url_for('static', filename='imgdois.png') }}" alt="Royal Burger">
        </a>

        <!--  ÍCONES CENTRALIZADOS -->
        <div class="header-center">
            <a href="{{ url_for('categorias') }}" class="header-item">
                <img src="{{ url_for('static', filename='categoria_hamburguer.png') }}">
                <span>Categorias</span>
            </a>

            <a href="{{ url_for('insumos') }}" class="header-item">
                <img src="{{ url_for('static', filename='insumos_hamburguer.png') }}">
                <span>Insumos</span>
            </a>

            <a href="{{ url_for('entradas') }}" class="header-item">
                <img src="{{ url_for('static', filename='entradas_hamburguer.png') }}">
                <span>Entradas</span>
            </a>

            <a href="{{ url_for('lanches') }}" class="header-item">
                <img src="{{ url_for('static', filename='cardapio_hamburgueria.png') }}">
                <span>Cardápio</span>
            </a>


            <a href="{{ url_for('bebidas') }}" class="header-item">
                <img src="{{ url_for('static', filename='bebidas_hamburguer.png') }}">
                <span>Bebidas</span>
            </a>


        </div>
    </div>


    {% if 'user_id' in session %}
    <!-- Código para quando o usuário ESTÁ logado (menu de perfil) -->
    <div style="display: flex; align-items: center; margin-left: auto; margin-right: 35px; gap: 10px;">
        <!-- From Uiverse.io by devkatyall -->
        <label class="popup">
            <input type="checkbox"/>
            <div tabindex="0" class="burger">
                <svg width="40" height="40" viewBox="0 0 130 130" xmlns="http://www.w3.org/2000/svg">
                    <style>
                        .circle {
                            stroke: #4da3ff;
                            fill: none;
                            stroke-width: 6;
                            animation: pulse 2.2s ease-in-out infinite;
                            transform-origin: 65px 65px;
                        }

                        .glow {
                            stroke: #4da3ff;
                            fill: none;
                            stroke-width: 10;
                            opacity: 0.15;
                            transform-origin: 65px 65px;
                            animation: breathe 3s ease-in-out infinite;
                        }

                        .head {
                            fill: #4da3ff;
                            animation: headFloat 3s ease-in-out infinite;
                        }

                        .body {
                            fill: #4da3ff;
                            animation: bodyFloat 3s ease-in-out infinite;
                            animation-delay: .15s;
                        }

                        .shine {
                            stroke: white;
                            stroke-width: 3;
                            stroke-linecap: round;
                            opacity: 0.0;
                            animation: shineMove 2.5s linear infinite;
                        }

                        @keyframes pulse {
                            0% {
                                transform: scale(1);
                            }
                            50% {
                                transform: scale(1.04);
                            }
                            100% {
                                transform: scale(1);
                            }
                        }

                        @keyframes breathe {
                            0% {
                                transform: scale(1);
                                opacity: .15;
                            }
                            50% {
                                transform: scale(1.12);
                                opacity: .25;
                            }
                            100% {
                                transform: scale(1);
                                opacity: .15;
                            }
                        }

                        @keyframes headFloat {
                            0% {
                                transform: translateY(0);
                            }
                            50% {
                                transform: translateY(-4px);
                            }
                            100% {
                                transform: translateY(0);
                            }
                        }

                        @keyframes bodyFloat {
                            0% {
                                transform: translateY(0);
                            }
                            50% {
                                transform: translateY(3px);
                            }
                            100% {
                                transform: translateY(0);
                            }
                        }

                        @keyframes shineMove {
                            0% {
                                transform: translate(-40px, -40px) rotate(45deg);
                                opacity: 0;
                            }
                            40% {
                                opacity: 0.5;
                            }
                            60% {
                                opacity: 0.2;
                            }
                            100% {
                                transform: translate(140px, 140px) rotate(45deg);
                                opacity: 0;
                            }
                        }
                    </style>

                    <!-- brilho circular -->
                    <circle cx="65" cy="65" r="52" class="glow"/>

                    <!-- círculo principal -->
                    <circle cx="65" cy="65" r="45" class="circle"/>

                    <!-- cabeça -->
                    <circle cx="65" cy="50" r="15" class="head"/>

                    <!-- corpo -->
                    <path d="M40 92 q25 -28 50 0 q-25 12 -50 0" class="body"/>

                    <!-- shine animado -->
                    <line x1="20" y1="20" x2="60" y2="60" class="shine"/>
                </svg>
            </div>
            <nav class="popup-window">
                <legend>Atalhos</legend>
                <ul>
                    <li>
                        <a href="{{ url_for('editar_pessoa', id_pessoa=session['user_id']) }}"
                           style="text-decoration: none">
                            <button>
                                <svg
                                        width="14"
                                        height="14"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1.2"
                                        stroke-linecap="round"
                                        xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path
                                            d="M19 4v6.406l-3.753 3.741-6.463-6.462 3.7-3.685h6.516zm2-2h-12.388l1.497 1.5-4.171 4.167 9.291 9.291 4.161-4.193 1.61 1.623v-12.388zm-5 4c.552 0 1 .449 1 1s-.448 1-1 1-1-.449-1-1 .448-1 1-1zm0-1c-1.104 0-2 .896-2 2s.896 2 2 2 2-.896 2-2-.896-2-2-2zm6.708.292l-.708.708v3.097l2-2.065-1.292-1.74zm-12.675 9.294l-1.414 1.414h-2.619v2h-2v2h-2v-2.17l5.636-5.626-1.417-1.407-6.219 6.203v5h6v-2h2v-2h2l1.729-1.729-1.696-1.685z"
                                    ></path>
                                </svg>
                                <span>Editar</span>
                            </button>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('logout') }}" style="text-decoration: none">
                            <button>
                                <svg
                                        width="14"
                                        height="14"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="1"
                                        stroke-linecap="round"
                                        xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path
                                            d="M2.598 9h-1.055c1.482-4.638 5.83-8 10.957-8 6.347 0 11.5 5.153 11.5 11.5s-5.153 11.5-11.5 11.5c-5.127 0-9.475-3.362-10.957-8h1.055c1.443 4.076 5.334 7 9.902 7 5.795 0 10.5-4.705 10.5-10.5s-4.705-10.5-10.5-10.5c-4.568 0-8.459 2.923-9.902 7zm12.228 3l-4.604-3.747.666-.753 6.112 5-6.101 5-.679-.737 4.608-3.763h-14.828v-1h14.826z"
                                    ></path>
                                </svg>
                                <span>Sair</span>
                            </button>
                        </a>
                    </li>
                </ul>
            </nav>
        </label>
        <!-- Nome e cargo do usuário -->
        <div class="user-details" style="color: #fff; font-size: 12px; text-align: left;">
            <p style="margin: 0; font-weight: bold;">{{ session['username'] }}</p>
            <p style="margin: 0; color: #ccc;">{{ session['papel'] }}</p>
        </div>
    </div>
    {% else %}
    <!-- Código para quando o usuário NÃO está logado (botão de login) -->
    <div style="display: flex; align-items: center; margin-left: auto; margin-right: 35px;">
        <!-- From Uiverse.io by reglobby -->
        <a href="{{ url_for('login') }}" style="text-decoration: none">
            <div aria-label="User Login Button" tabindex="0" role="button" class="user-profile">
                <div class="user-profile-inner">
                    <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <g data-name="Layer 2" id="Layer_2">
                            <path d="m15.626 11.769a6 6 0 1 0 -7.252 0 9.008 9.008 0 0 0 -5.374 8.231 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 9.008 9.008 0 0 0 -5.374-8.231zm-7.626-4.769a4 4 0 1 1 4 4 4 4 0 0 1 -4-4zm10 14h-12a1 1 0 0 1 -1-1 7 7 0 0 1 14 0 1 1 0 0 1 -1 1z"></path>
                        </g>
                    </svg>
                    <span>Log In</span>
                </div>
            </div>
        </a>
    </div>
    {% endif %}


</header>
{% block content %}
{% if request.endpoint == 'index' %}
<div class="bg-image"></div>
{% endif %}


<!--            <a class="rota_inicial" href="{{ url_for('pessoas') }}">PESSOAS</a>-->

<!--            <a  class="rota_inicial" href="{{ url_for('cadastrar_pessoas') }}">Cadastrar pessoas</a>-->



<main style="
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 30px;           /* Espaço entre os gráficos */
    overflow-y: auto;     /* Permite rolagem vertical */
    overflow-x: hidden;   /* Remove rolagem horizontal */
    max-height: calc(100vh - 120px); /* Altura da tela menos o header */
">

    <!-- Gráfico de Vendas -->
    <div class="card-grafico">
        <h2>Gráfico de Vendas</h2>
        <canvas id="graficoVendas"></canvas>
    </div>

    <!-- Gráfico de Funcionários -->


    <div class="card-grafico">
        <h2>Desempenho dos Garçons por mes</h2>
        <canvas id="graficoFuncionariosmes"></canvas>
    </div>

</main>



{% endblock %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="../static/script.js"></script>
<!-- BOOTSTRAP JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    async function carregarDados() {
        try {
            const resposta = await fetch("http://192.168.0.14:5002/dados_grafico");
            const dados = await resposta.json();

            const ctx = document.getElementById("graficoVendas").getContext("2d");
            if (!ctx) return;
            // Criando gradiente moderno
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, "rgb(61,61,62)");
            gradient.addColorStop(1, "rgba(0, 153, 255, 0)");

            new Chart(ctx, {
                type: "line",
                data: {
                    labels: dados.labels,
                    datasets: [{
                        label: "Vendas",
                        data: dados.values,
                        borderWidth: 3,
                        borderColor: "rgb(218,165,32)",
                        backgroundColor: gradient,
                        pointRadius: 5,
                        pointBackgroundColor: "#3d3d3e",
                        tension: 0.4 // deixa a linha mais curva e bonita
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            labels: {
                                color: "#fff",
                                font: {size: 14}
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {color: "#ccc"},
                            grid: {display: false}
                        },
                        y: {
                            ticks: {color: "#ccc"},
                            grid: {
                                color: "rgba(255,255,255,0.1)"
                            }
                        }
                    }
                }
            });

        } catch (err) {
            console.error("Erro no gráfico:", err);
        }
    }

    carregarDados();


</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function carregargraficoFuncionariosmes() {
    try {
        const resposta = await fetch("/dados_grafico_funcionarios_mes");
        const dados = await resposta.json();

        if (dados.erro) {
            console.error("Erro:", dados);
            return;
        }

        const canvas = document.getElementById("graficoFuncionariosmes");
        if (!canvas) return;

        const ctx = canvas.getContext("2d");

        new Chart(ctx, {
            type: "bar",
            data: {
                labels: dados.labels,
                datasets: [{
                    label: "Total vendido no mês (R$)",
                    data: dados.totals,
                    backgroundColor: "rgba(218,165,32,0.7)",
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        labels: { color: "#fff" }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: "#ccc" }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: "#ccc",
                            callback: function(value) {
                                return "R$ " + value;
                            }
                        }
                    }
                }
            }
        });

    } catch (erro) {
        console.error("Erro ao carregar gráfico:", erro);
    }
}

document.addEventListener("DOMContentLoaded", carregargraficoFuncionariosmes);
</script>
</body>
</html>